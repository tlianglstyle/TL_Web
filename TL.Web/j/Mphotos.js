var p_url = ""; var pList = { id: 0, count: 0, slider: false }; var c_sort = "#photo_list"; var show = false; var p_w = 179; var p_h = 179; var p_w_s = 5; var p_h_s = 3; var m = 18; var c = null; var p = { w: 0, h: 0, l: 0, t: 0, iw: 0, ih: 0, id: 0 }; var page = { index: 0, sum: 0, count: 15 }; var share = { ids: "", title: "", desc: "", pics: "", summary: "" }; $(function () { if (paratemeters != "") { var e = paratemeters.split("."); pList.id = parseInt(e[0]); p.id = parseInt(e[1]); pList.count = parseInt(e[2]); pList.slider = false; p_h = p_h; page.index = 0; page.sum = 0; if (pList.id != undefined && pList.id != 0 && pList.count != undefined && pList.count != 0) { var h = $("[v=" + pList.id + "]"); pList.id = h.attr("v"); share.title = h.attr("t") || "TliangL"; share.desc = h.attr("d") || "TliangL"; share.summary = h.attr("s") || "TliangL"; page.sum = parseInt(pList.count / page.count) + parseInt(pList.count % page.count > 0 ? 1 : 0); $("#photo_page").html(""); for (var d = 1; d <= page.sum; d++) { $("#photo_page").append('<a title="' + d + '" v="' + d + '" class="c"><div></div></a>') } $("#photo_control").a({ left: -1024 }, 0); $(c_sort).find("li").remove(); setTimeout(function () { b(0); if (nav_status == 1) { $("#nav").stop().a({ top: -40 }, 200); $("#nav_bg").stop().a({ height: 0 }, 200); setTimeout(function () { nav_control(true); setTimeout(function () { pList.slider = true }, 0) }, 100) } }, 0) } setTimeout(function () { $(".nav_open").css("top", "-90px"); if (pList.slider) { $(".nav_open").hide().delay(1100).t(-90); if (!$(c_sort + " li").is(":animated")) { c = $(c_sort + " li:eq(" + (p.id - 1) + ")"); share.ids = pList.id + "." + c.attr("v") + "." + pList.count; share.pics = "http://www.tliangl.com/p/p/" + pList.id + "/" + c.attr("v") + ".jpg"; c.children("img:eq(1)").attr("src", "/p/p/" + pList.id + "/" + c.attr("v") + ".jpg"); if (!light) { $("#nav").stop().a({ top: -40 }, 200); $("#nav_bg").stop().a({ height: 0 }, 200); nav_control(false); nav_light(true); light_open() } c.children("img:eq(0)").hide(); p.t = parseFloat(c.t()); p.l = parseFloat(c.l()); p.w = parseFloat(c.w()); p.h = parseFloat(c.h()); p.iw = parseFloat(c.children("img:eq(1)").css("max-width")); p.ih = parseFloat(c.children("img:eq(1)").css("max-height")); c.a({ left: -38, top: 0, width: 1034, height: 1024 }, 500); c.css("z-index", 999).children("img:eq(1)").show().css({ "max-width": "1034px", "max-height": "1024px" }); $("#photo_tool").delay(500).slideDown(200); c.siblings().fadeOut(500); c.removeClass("x_1").removeClass("x_2").removeClass("x_3").removeClass("x_4"); c.removeClass("x_m"); show = true } } }, 1000) } index = 4; $(".nav_" + index).bgPosition(nav_bg[index].x, nav_bg[index].y).a({ left: 0 }, 150); $("#photos ul li").hover(function () { if ($(this).hasClass("itme_2_2")) { $(this).op(1).find("div").stop().a({ top: 370 }, 100) } else { $(this).op(1).find("div").stop().a({ top: 170 }, 100) } }, function () { if ($(this).hasClass("itme_2_2")) { $(this).find("div").stop().a({ top: 405 }, 100); if ($(this).hasClass("y")) { $(this).find("img:eq(0)").t(-405).stop().a({ top: 0 }, 500); $(this).find("img:eq(1)").t(0).stop().a({ top: 405 }, 500); $(this).removeClass("y").addClass("n") } else { $(this).find("img:eq(0)").t(0).stop().a({ top: -405 }, 500); $(this).find("img:eq(1)").t(405).stop().a({ top: 0 }, 500); $(this).removeClass("n").addClass("y") } } else { $(this).find("div").stop().a({ top: 202 }, 100); if ($(this).hasClass("y")) { $(this).find("img:eq(0)").t(-202).stop().a({ top: 0 }, 500); $(this).find("img:eq(1)").t(0).stop().a({ top: 202 }, 500); $(this).removeClass("y").addClass("n") } else { $(this).find("img:eq(0)").t(0).stop().a({ top: -202 }, 500); $(this).find("img:eq(1)").t(202).stop().a({ top: 0 }, 500); $(this).removeClass("n").addClass("y") } } }); $("#photo_show ul li").hover(function () { $(this).find("a").stop().a({ top: 10 }, 100) }, function () { $(this).find("a").stop().a({ top: 20 }, 100) }); $("#photos ul li,#photo_show ul li").afterbind("click", function () { pList.count = $(this).attr("c"); if (pList.count.toString() != "0") { pList.id = $(this).attr("v"); share.title = $(this).attr("t") || ""; share.desc = $(this).attr("d") || ""; share.summary = $(this).attr("s") || ""; pList.slider = false; p_h = $(this).attr("h") != null ? parseFloat($(this).attr("h")) : p_h; page.index = 0; page.sum = 0; if (pList.id != undefined && pList.id != 0 && pList.count != undefined && pList.count != 0) { page.sum = parseInt(pList.count / page.count) + parseInt(pList.count % page.count > 0 ? 1 : 0); $("#photo_page").html(""); for (var j = 1; j <= page.sum; j++) { $("#photo_page").append('<a title="' + j + '" v="' + j + '" class="c"><div></div></a>') } $("#photo_control").a({ left: -1024 }, 500); $(c_sort).find("li").remove(); setTimeout(function () { b(500); if (nav_status == 1) { $("#nav").stop().a({ top: -40 }, 200); $("#nav_bg").stop().a({ height: 0 }, 200); setTimeout(function () { nav_control(true); setTimeout(function () { pList.slider = true }, 1100) }, 1000) } }, 500) } } }); $("#photo_back").click(function () { if (!$(".nav_open").is(":animated") && !$(".nav_light").is(":animated")) { nav_status = 0; nav_open(); nav_light(false); light_close(); $("#photo_control").a({ left: 0 }, 500); $("#photo_tool").fadeOut(500) } }); $(c_sort + " li").afterbind("click", function () { if (pList.slider) { $(".nav_open").hide().delay(1100).t(-90); if (!$(c_sort + " li").is(":animated")) { if (!show) { share.ids = pList.id + "." + $(this).attr("v") + "." + pList.count; share.pics = "http://www.tliangl.com/p/p/" + pList.id + "/" + $(this).attr("v") + ".jpg"; $(this).children("img:eq(1)").attr("src", "/p/p/" + pList.id + "/" + $(this).attr("v") + ".jpg"); if (!light) { $("#nav").stop().a({ top: -40 }, 200); $("#nav_bg").stop().a({ height: 0 }, 200); nav_control(false); nav_light(true); light_open() } c = $(this); c.children("img:eq(0)").hide(); p.t = parseFloat(c.t()); p.l = parseFloat(c.l()); p.w = parseFloat(c.w()); p.h = parseFloat(c.h()); p.iw = parseFloat(c.children("img:eq(1)").css("max-width")); p.ih = parseFloat(c.children("img:eq(1)").css("max-height")); c.a({ left: -38, top: 0, width: 1034, height: 1024 }, 500); c.css("z-index", 999).children("img:eq(1)").show().css({ "max-width": "1034px", "max-height": "1024px" }); $("#photo_tool").delay(500).slideDown(200); c.siblings().fadeOut(500); c.removeClass("x_1").removeClass("x_2").removeClass("x_3").removeClass("x_4"); c.removeClass("x_m"); show = true } else { $(c_sort + " li").show(); c.a({ left: p.l, top: p.t, width: p.w, height: p.h }, 500); $("#photo_tool").slideUp(200); c.delay(500).siblings().fadeIn(500); setTimeout(function () { c.css("z-index", 1); c.children("img:eq(1)").css({ "max-width": p.iw, "max-height": p.ih }).hide().attr("src", "").prev().show() }, 510); $(this).addClass("x_m"); $(this).addClass("x_" + GetRandomNum(1, 4)); show = false } } } }); $("#photo_page a").afterbind("click", function () { $(this).addClass("c").siblings().removeClass("c"); page.index = parseInt($(this).attr("v")); b(500) }); $("#photo_tool .close").click(function () { c.siblings().hide().fadeIn(500); setTimeout(function () { c.css("z-index", 2).children("img:eq(1)").css({ "max-width": p.iw, "max-height": p.ih }).delay(500).css("z-index", 2).hide().attr("src", "").prev().show(); c.a({ left: p.l, top: p.t, width: p.w, height: p.h }, 500); $("#photo_tool").fadeOut(500); c.addClass("x_m"); c.addClass("x_" + GetRandomNum(1, 4)); show = false }, 0) }).next().click(function () { if (pList.slider && !$(c_sort + " li").is(":animated") && show) { if ($(c_sort).children().index(c) + 1 < $("#photo_list li").length) { c.a({ left: -1024 }, 150); c.next().children("img:eq(1)").attr("src", "/p/p/" + pList.id + "/" + c.next().attr("v") + ".jpg").show().prev().hide(); show = false; setTimeout(function () { c.css("z-index", 1).children("img:eq(1)").css({ "max-width": "190px", "max-height": "190px" }).hide().attr("src", "").prev().show(); c.hide().css({ left: p.l, top: p.t, width: p.w, height: p.h }).addClass("x_" + GetRandomNum(1, 4)); setTimeout(function () { c = c.next(); share.ids = pList.id + "." + c.attr("v") + "." + pList.count; share.pics = "http://www.tliangl.com/p/p/" + pList.id + "/" + c.attr("v") + ".jpg"; p.t = parseFloat(c.t()); p.l = parseFloat(c.l()); p.w = parseFloat(c.w()); p.h = parseFloat(c.h()); p.iw = parseFloat(c.children("img").css("max-width")); p.ih = parseFloat(c.children("img").css("max-height")); c.css({ left: 1024, top: 0, width: 1034, height: 1024 }); c.show().a({ left: -38, top: 0 }, 300); c.removeClass("x_1").removeClass("x_2").removeClass("x_3").removeClass("x_4"); c.css("z-index", 999).children("img:eq(1)").css({ "max-width": "1034px", "max-height": "1024px" }); $("#photo_tool").delay(200).slideDown(200); c.siblings().fadeOut(400); show = true }, 100) }, 200) } else { if (page.index < page.sum) { page.index++; b(500) } } } }).next().click(function () { if (pList.slider && !$(c_sort + " li").is(":animated") && show) { if ($(c_sort).children().index(c) > 0) { c.a({ left: 1024 }, 150); c.prev().children("img:eq(1)").attr("src", "/p/p/" + pList.id + "/" + c.next().attr("v") + ".jpg").show().prev().hide(); show = false; setTimeout(function () { c.css("z-index", 1).children("img:eq(1)").css({ "max-width": "190px", "max-height": "190px" }).hide().attr("src", "").prev().show(); c.hide().css({ left: p.l, top: p.t, width: p.w, height: p.h }); setTimeout(function () { c = c.prev(); share.ids = pList.id + "." + c.attr("v") + "." + pList.count; share.pics = "http://www.tliangl.com/p/p/" + pList.id + "/" + c.attr("v") + ".jpg"; p.t = parseFloat(c.t()); p.l = parseFloat(c.l()); p.w = parseFloat(c.w()); p.h = parseFloat(c.h()); p.iw = parseFloat(c.children("img:eq(1)").css("max-width")); p.ih = parseFloat(c.children("img:eq(1)").css("max-height")); c.css({ left: -1024, top: 0 }); c.show().a({ left: -38, top: 0, width: 1034, height: 1024 }, 300); c.removeClass("x_1").removeClass("x_2").removeClass("x_3").removeClass("x_4"); c.css("z-index", 999).children("img:eq(1)").css({ "max-width": "1034px", "max-height": "1024px" }); $("#photo_tool").delay(200).slideDown(200); c.siblings().fadeOut(400); show = true }, 100) }, 200) } else { if (page.index > 1) { page.index--; b(500) } } } }); $(".share").click(function () { if (share.ids.length > 5) { var k = ""; var l = $(".share").index($(this)); switch (l) { case 0: k = "http://www.douban.com/share/service?href=http://www.tliangl.com/" + share.ids + ".aspx&name=" + share.title + "&text=" + share.desc + "&image=" + share.pics; break; case 1: k = "http://share.v.t.qq.com/index.php?c=share&a=index&url=http://www.tliangl.com/" + share.ids + ".aspx&title=" + share.desc + "&pic=" + share.pics; break; case 2: k = "http://service.weibo.com/share/share.php?url=http://www.tliangl.com/" + share.ids + ".aspx&title=" + share.desc + "&pic=" + share.pics; break; case 3: k = "http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=http://www.tliangl.com/" + share.ids + ".aspx&title=" + share.title + "&desc=" + share.desc + "&summary=" + share.summary + "&site=&pics=" + share.pics; break } window.open(k) } else { if (!show) { var k = ""; var l = $(".share").index($(this)); var n = "photos"; var r = "谭亮小盆友的相册"; var q = "谭亮小盆友的相册"; var j = "谭亮小盆友的相册"; var o = ""; switch (l) { case 0: k = "http://www.douban.com/share/service?href=http://www.tliangl.com/" + n + ".aspx&name=" + r + "&text=" + q + "&image=" + o; break; case 1: k = "http://share.v.t.qq.com/index.php?c=share&a=index&url=http://www.tliangl.com/" + n + ".aspx&title=" + q + "&pic=" + o; break; case 2: k = "http://service.weibo.com/share/share.php?url=http://www.tliangl.com/" + n + ".aspx&title=" + q + "&pic=" + o; break; case 3: k = "http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=http://www.tliangl.com/" + n + ".aspx&title=" + r + "&desc=" + q + "&summary=" + j + "&site=&pics=" + o; break } window.open(k) } } }); var g = new Image(); function a(i) { if (g.src != i.src) { g.src = i.src } return g.width } function f(i) { if (g.src != i.src) { g.src = i.src } return g.height } function b(u) { $("#photo_page a:eq(" + (page.index < 2 ? 0 : page.index - 1) + ")").addClass("c").siblings().removeClass("c"); $("#photo_tool").hide(); show = false; if (page.index == 0) { var v = ""; var j = 0; if (page.sum == 1) { j = pList.count } else { j = page.count } for (var q = 1; q <= j; q = q + 1) { v += "<li class='x_m x_" + (GetRandomNum(1, 3) + q % 2) + "' v='" + q + "'><img url=\"http://tliangl.com/" + pList.id + "." + q + "." + pList.count + '.aspx" src="/p/p/' + pList.id + "/" + (q) + '_min.jpg" /><img class="max none" src="" /></li>' } $(c_sort).html(v); $(c_sort + " li").w(p_w).h(p_h); $(c_sort + " li:animated").stop(true, false); var r = new Array(); var q = 0; $(c_sort + " li").hide().each(function () { r[q] = $(this).attr("v"); q++ }); for (var s = 0; s < r.length; s++) { var k = $(c_sort + " li[v=" + r[s] + "]"); var w = 0, n = 0; w = m + (p_h + m) * (parseInt((s) / p_w_s)); n = m + (p_w + m) * (parseInt((s + 1) % p_w_s) == 0 ? (p_w_s - 1) : parseInt(s % p_w_s)); k.show(); k.a({ top: w, left: n }, u) } } else { var v = ""; var j = 0; if (page.sum == 1) { j = pList.count } else { if (page.index < page.sum) { j = page.count } else { j = pList.count - (page.sum - 1) * page.count } } for (var q = 1 + (page.index - 1) * page.count; q <= (page.index - 1) * page.count + j; q = q + 1) { v += "<li class='x_m x_" + (GetRandomNum(1, 3) + q % 2) + "' v='" + q + "'><img url=\"http://tliangl.com/" + pList.id + "." + q + "." + pList.count + '.aspx" src="/p/p/' + pList.id + "/" + (q) + '_min.jpg" /><img class="max none" src="" /></li>' } $(c_sort).html(v); $(c_sort + " li").w(p_w).h(p_h).l(0).t(55 * (page.index - 1)); $(c_sort + " li:animated").stop(true, false); var r = new Array(); var q = 0; $(c_sort + " li").hide().each(function () { r[q] = $(this).attr("v"); q++ }); for (var s = 0; s < r.length; s++) { var k = $(c_sort + " li[v=" + r[s] + "]"); var w = 0, n = 0; w = m + (p_h + m) * (parseInt((s) / p_w_s)); n = m + (p_w + m) * (parseInt((s + 1) % p_w_s) == 0 ? (p_w_s - 1) : parseInt(s % p_w_s)); k.show(); k.delay(130).a({ top: w, left: n }, u) } } } });
