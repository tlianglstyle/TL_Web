function bind(load) { $.ajax({ type: "get", url: "/service/service.ashx?action=GetResource&rid=" + requestid + "&rsize=" + requestsize + "&pid=" + pageid + "&psize=" + pagesize + "&f_c=" + f_c + "&f_t=" + f_t + "&o=" + o, success: function (data) { data = eval("(" + data + ")"), sumrows = data.total, sumrows == 0, load && ($.tl_page_slider({ pageid: pageid, pagesize: pagesize, sumrows: sumrows, fun: function (e) { pageid = e, url() }, request: !0 }), $("#my_page").hide()); if (data.rows.length > 0) for (var i = 0; i < data.rows.length; i++) { var content = "<div v=" + data.rows[i].id + ' class="load">'; content += '<div class="block_i">', content += '<a target="_blank" href="resource_details.aspx?id=' + data.rows[i].id + '">', content += '<img src="r/img/' + data.rows[i].id + '.jpg" width="240" height="136"></a>', content += '<div class="bg"></div>', content += '<div class="block_op"><a class="title" target="_blank" href="resource_details.aspx?id=' + data.rows[i].id + '">' + data.rows[i].name + "</a>" + (role ? '<a class="edit" target="_blank" href="resource_edit.aspx?id=' + data.rows[i].id + '" title="编辑"></a>' : "") + '<a class="share" title="喜欢"></a></div>', content += "</div>", content += "<p>", content += '<span class="hits" title="' + data.rows[i].clicks + '次浏览">' + data.rows[i].clicks + "</span>", content += '<span class="heats" title="' + data.rows[i].commends + '人推荐">' + data.rows[i].commends + "</span>", content += '<a class="url" target="_blank" href="' + data.rows[i].url + '" class="link_url" target="_blank" title="在新的页面直接打开该网站">&nbsp;</a>', role && (content += '<a target="_blank" href="resource_edit.aspx?id=' + data.rows[i].id + '">编辑</a>&nbsp;<a class="del">删除</a>'), content += "</p>", content += "</div>", content += "", content += "", content += ""; var bindIndex = 0; if (load) bindIndex = (i + 1) % requestcolumns == 0 ? requestcolumns - 1 : (i + 1) % requestcolumns - 1; else { var colTop = 1e5; $("#list > div").each(function () { $(this).children("div:last").offset().top < colTop && (colTop = $(this).children("div:last").offset().top, bindIndex = $("#list > div").index($(this))) }) } $("#list > div:eq(" + bindIndex + ")").append(content), $("#list > div > div.load").fadeIn(1e3).delay(1e3).removeClass("load"), $(".loading").hide() } else $(".loading").hide() }, error: function () { alert("数据读取错误！") } }) } function url() { window.location.href = "resources.aspx?pageid=" + pageid + "&pagesize=" + requestcolumns * requestcount + "&f_c=" + f_c + "&f_t=" + f_t + "&o=" + o + "&t=" + requestcolumns } var f_c = -1, f_t = -1, o = -1, s = "", sumrows = 0, requestid = 1, columns = [0, 0, 0, 315, 230, 180], requestcolumns = 4, requestsize = 0, requestcount = 10, pageid = 1, pagesize = 0; $(function () { role ? $("#btn_add").show() : $("#btn_add").remove(), f_c = parastr("f_c"), f_t = parastr("f_t"), o = parastr("o"), requestcolumns = parastr("t"), pageid = parastr("pageid"), pagesize = parastr("pagesize"); if (f_c == null || f_c == -1) f_c = -1, $("#filter-color ul li:eq(0)").addClass("c"); if (f_t == null || f_t == -1) f_t = -1, $("#filter-category ul li:eq(0)").addClass("c"); o == null || o == -1 ? (o = -1, $(".item-order a[v=1]").addClass("c")) : $(".item-order a[v=" + o + "]").addClass("c"); if (requestcolumns == null || requestcolumns == -1) requestcolumns = 4; requestsize = requestcolumns * 1, pagesize = requestsize * requestcount, pageid == null && (pageid = 1), pagesize == null && (pagesize = 100), $("#list > div:gt(" + (requestcolumns - 1) + ")").remove(), $("#list").addClass("columns" + requestcolumns), bind(!0), $("#filter-color ul li").click(function () { f_c = $(this).attr("v"), url() }), $("#filter-category ul li").click(function () { f_t = $(this).attr("v"), url() }), $(".item-order a").click(function () { o = $(this).attr("v"), url() }), $("#list > div .block_i").afterbind("mouseenter", function (e) { if (!$(this).children(".block_op").is(":animated")) { var t = getMousePos(e), n = $(this).parent(), r = columns[requestcolumns], i = $(this).offset(), s = n.find(".url").offset(), o = s.top - i.top, u = 50; t.x < i.left + u && t.y > i.top + u && t.y < i.top + o - u ? $(this).children(".block_op").stop().show().op(1).t(0).l(-r).a({ left: 0 }, 200) : t.x > i.left + r - 20 && t.y > i.top + u && t.y < i.top + o - u ? $(this).children(".block_op").stop().show().op(1).op(1).t(0).l(r).a({ left: 0 }, 200) : t.y < i.top + u ? $(this).children(".block_op").stop().show().op(1).l(0).t(-o).a({ top: 0 }, 200) : t.y > i.top + o - u && $(this).children(".block_op").stop().show().op(1).l(0).t(o).a({ top: 0 }, 200) } }), $("#list > div .block_i").afterbind("mouseleave", function (e) { var t = getMousePos(e), n = $(this).parent(), r = columns[requestcolumns], i = $(this).offset(), s = n.find(".url").offset(), o = s.top - i.top, u = 0; t.x > i.left + r ? $(this).children(".block_op").stop().show().a({ left: r + 10 }, 200) : t.x < i.left ? $(this).children(".block_op").stop().show().a({ left: -r - 10 }, 200) : t.y > s.top - 20 ? $(this).children().show().a({ top: o }, 200) : t.y < i.top && $(this).children(".block_op").stop().show().a({ top: -o }, 200) }); var e = null; $("#list > div p .del").afterbind("click", function () { confirm("确定删除吗?") && (e = $(this).parent().parent(), $.ajax({ type: "get", url: "/service/action.ashx?action=DeleteResource&list=" + e.attr("v"), success: function (t) { e.fadeOut(500).delay(500).remove() } })) }), $("#list > div .block_i .share").afterbind("click", function () { alert("ok") }) }); var browser = getBrowser(), reset = 0, surplusHeight = 800, pageTran = !1, load = !1; window.onscroll = function () { if (reset == 0) { var e = browser == "Firefox" ? document.documentElement.scrollHeight : document.body.scrollHeight, t = document.body.scrollTop || document.documentElement.scrollTop, n = e - t; n < surplusHeight + 200 && sumrows != 0 && (requestid < requestcount ? pageTran || (pageTran = !0, $(".loading").show(), reset = 1, setTimeout(function () { requestid++, bind(!1) }, 1e3), setTimeout(function () { pageTran = !1, load && (load = !1) }, 1e3)) : $("#my_page").show()) } else setTimeout(function () { reset = 0 }, 1e3) }, $(function () { index = 3, $(".nav_" + index).bgPosition(nav_bg[index].x, nav_bg[index].y).stop().a({ left: 0 }, 150), $("#color-more").toggle(function () { $(this).css("background-position", "-5px -165px"), $("#filter-color ul").css("height", "auto") }, function () { $(this).css("background-position", "-5px -146px"), $("#filter-color ul").a({ height: 47 }, 200) }), $("#category-more").toggle(function () { $(this).css("background-position", "-5px -165px"), $("#filter-category ul").css({ "max-height": "200px", height: "100%" }) }, function () { $(this).css("background-position", "-5px -146px"), $("#filter-category ul").a({ height: 70 }, 200) }), $(".checkbox-category").toggle(function () { $(this).css("background-position", "0 -209px") }, function () { $(this).css("background-position", "0 -192px") }), $(".checkbox-filter").toggle(function () { $(this).css("background-position", "0 -209px") }, function () { $(this).css("background-position", "0 -192px") }), $(".checkbox-category-all").toggle(function () { $(".checkbox-category").css("background-position", "0 -209px") }, function () { $(".checkbox-category").css("background-position", "0 -192px") }), $(".checkbox-filter-all").toggle(function () { $(".checkbox-filter").css("background-position", "0 -209px") }, function () { $(".checkbox-filter").css("background-position", "0 -192px") }), $("#filter_1_ul").show(), $("#filter-filter #filter-filter-ul").children("li").click(function () { $("#" + $(this).attr("id") + "_ul").show().siblings().hide(), $(this).removeClass("filter-filter-default").addClass("filter-filter-check").siblings("li").removeClass("filter-filter-check").addClass("filter-filter-default") }); var e = { min: 200, inDelay: 600, outDelay: 400, container: "#toTops", containerTop: "#toTops .item3 a", scrollSpeed: 200, easingType: "linear" }, t = e.container, n = e.containerTop; $(t).show(), $(n).hide().click(function () { $("html, body").animate({ scrollTop: 0 }, 200) }), $(window).scroll(function () { var r = $(window).scrollTop(); typeof document.body.style.maxHeight == "undefined" && $(t).css({ position: "absolute", top: $(window).scrollTop() + $(window).height() - 50 }), r > e.min ? $(n).fadeIn(e.inDelay) : $(n).fadeOut(e.Outdelay) }), $("#toTops .item1 a").click(function () { requestcolumns = 3, url() }), $("#toTops .item2 a").click(function () { requestcolumns = 4, url() }), $("#toTops .item3 a").hover(function () { $(this).a({ left: -50 }, 150) }, function () { $(this).a({ left: 0 }, 150) }) })