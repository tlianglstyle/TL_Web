var f_c = -1, f_t = -1, o = -1, s = "", sid = 0; var sumrows = 0; var requestid = 1; var columns = [0, 0, 0, 315, 230, 180]; var requestcolumns = 4; var requestsize = 0; var requestcount = 20; var pageid = 1; var pagesize = 0; $(function () { if (role) { $("#btn_add").show() } else { $("#btn_add").remove() } f_c = parastr("f_c"); f_t = parastr("f_t"); o = parastr("o"); sid = parastr("sid"); if (sid == null) { sid = 0 } requestcolumns = parastr("t"); pageid = parastr("pageid"); pagesize = parastr("pagesize"); if (f_c == null || f_c == -1) { f_c = -1; $("#filter-color ul li:eq(0)").addClass("c") } if (f_t == null || f_t == -1) { f_t = -1; $("#filter-category ul li:eq(0)").addClass("c") } if (o == null || o == -1) { o = -1; $(".item-order a[v=" + 1 + "]").addClass("c") } else { $(".item-order a[v=" + o + "]").addClass("c") } if (requestcolumns == null || requestcolumns == -1) { requestcolumns = 4 } else { } requestsize = requestcolumns * 1; pagesize = requestsize * requestcount; if (pageid == null) { pageid = 1 } if (pagesize == null) { pagesize = 100 } $("#list > div:gt(" + (requestcolumns - 1) + ")").remove(); $("#list").addClass("columns" + requestcolumns); bind_load(); bind(true); $("#filter-color ul li").click(function () { f_c = $(this).attr("v"); url() }); $("#filter-category ul li").click(function () { f_t = $(this).attr("v"); url() }); $(".item-order a").click(function () { o = $(this).attr("v"); url() }); $("#list > div .block_i").afterbind("mouseenter", function (n) { if (!$(this).children(".block_op").is(":animated")) { var d = getMousePos(n); var j = $(this).parent(); var f = columns[requestcolumns]; var c = $(this).offset(); var l = j.find(".url").offset(); var k = l.top - c.top; var g = 50; if (d.x < c.left + g && d.y > c.top + g && d.y < c.top + k - g) { $(this).children(".block_op").stop().show().op(1).t(0).l(-f).a({ left: 0 }, 200) } else { if (d.x > c.left + f - 20 && d.y > c.top + g && d.y < c.top + k - g) { $(this).children(".block_op").stop().show().op(1).op(1).t(0).l(f).a({ left: 0 }, 200) } else { if (d.y < c.top + g) { $(this).children(".block_op").stop().show().op(1).l(0).t(-k).a({ top: 0 }, 200) } else { if (d.y > c.top + k - g) { $(this).children(".block_op").stop().show().op(1).l(0).t(k).a({ top: 0 }, 200) } } } } } }); $("#list > div .block_i").afterbind("mouseleave", function (n) { var d = getMousePos(n); var j = $(this).parent(); var f = columns[requestcolumns]; var c = $(this).offset(); var l = j.find(".url").offset(); var k = l.top - c.top; var g = 0; if (d.x > c.left + f) { $(this).children(".block_op").stop().show().a({ left: f + 10 }, 200) } else { if (d.x < c.left) { $(this).children(".block_op").stop().show().a({ left: -f - 10 }, 200) } else { if (d.y > l.top - 20) { $(this).children().show().a({ top: k }, 200) } else { if (d.y < c.top) { $(this).children(".block_op").stop().show().a({ top: -k }, 200) } else { } } } } }); var b = null; $("#list > div p .del").afterbind("click", function () { if (confirm("确定删除吗?")) { b = $(this).parent().parent(); $.ajax({ type: "get", url: "/service/action.ashx?action=DeleteResources&list=" + b.attr("v"), success: function (c) { b.fadeOut(500).delay(500).remove() } }) } }); var a = null; $("#list > div .block_i .share").afterbind("click", function () { a = $(this); $.ajax({ type: "get", url: "/service/action.ashx?action=shareAuto&tid=" + $(this).attr("v") + "&col=collects", success: function (d) { if (d == "1") { a.fadeOut(500); var e = a.parent().parent().siblings("p").children(".heats"); e.html((parseInt(e.html()) + 1) + "") } } }) }) }); var browser = getBrowser(); var reset = 0; var surplusHeight = 800; var pageTran = false; var load = false; window.onscroll = function () { if (reset == 0) { var b = (browser == "Firefox") ? document.documentElement.scrollHeight : document.body.scrollHeight; var c = document.body.scrollTop || document.documentElement.scrollTop; var a = b - c; if (a < surplusHeight + 200 && sumrows != 0) { if (requestid < requestcount) { if (!pageTran) { pageTran = true; $(".loading").show(); reset = 1; setTimeout(function () { requestid++; bind(false) }, 1000); setTimeout(function () { pageTran = false; if (load) { load = false } }, 1000) } } else { $("#my_page").show() } } } else { setTimeout(function () { reset = 0 }, 1000) } }; function bind_load() { $.ajax({ type: "get", url: "/service/service.ashx?action=GetShareList&rid=" + requestid + "&rsize=" + requestsize + "&pid=" + pageid + "&psize=" + pagesize + "&f_c=" + f_c + "&f_t=" + f_t + "&o=" + o + "&sid=" + sid, success: function (data) { data = eval("(" + data + ")"); sumrows = data.total; if (data.rows.length > 0) { for (var i = 0; i < data.rows.length; i++) { var content = "<div v=" + data.rows[i].id + ' class="load">'; content += '<div class="block_i">'; content += '<a target="_blank" href="sharec' + data.rows[i].id + '.aspx">'; content += '<img src="p/s/' + data.rows[i].shareid + "/" + data.rows[i].sid + '_230.jpg" width="240" height="136"></a>'; content += '<div class="bg"></div>'; content += '<div class="block_op"><a class="title" target="_blank" href="sharec' + data.rows[i].id + '.aspx">' + data.rows[i].pname + '</a><a class="edit" href="share_list.aspx?sid=' + data.rows[i].shareid + '" title="相关"></a><a v="' + data.rows[i].shareid + '" class="share" title="喜欢"></a></div>'; content += "</div>"; content += "<p>"; content += '<span class="hits" title="' + data.rows[i].clicks + '次浏览">' + data.rows[i].clicks + "</span>"; content += '<span class="heats" title="' + data.rows[i].collects + '人喜欢">' + data.rows[i].collects + "</span>"; content += '<a class="url" target="_blank" href="sharec' + data.rows[i].id + '.aspx" class="link_url" target="_blank" title="打开">&nbsp;</a>'; if (role) { content += '<a target="_blank" href="resource_edit.aspx?id=' + data.rows[i].id + '">编辑</a>&nbsp;<a class="del">删除</a>' } content += "</p>"; content += "</div>"; content += ""; content += ""; content += ""; var bindIndex = 0; bindIndex = (i + 1) % requestcolumns == 0 ? requestcolumns - 1 : (i + 1) % requestcolumns - 1; $("#list > div:eq(" + bindIndex + ")").append(content); $("#list > div > div.load").fadeIn(1000).delay(1000).removeClass("load"); $(".loading").hide() } } else { $(".loading").hide() } }, error: function () { alert("数据读取错误！") } }); requestid++ } function bind(load) { $.ajax({ type: "get", url: "/service/service.ashx?action=GetShareList&rid=" + requestid + "&rsize=" + requestsize + "&pid=" + pageid + "&psize=" + pagesize + "&f_c=" + f_c + "&f_t=" + f_t + "&o=" + o + "&sid=" + sid, success: function (data) { data = eval("(" + data + ")"); sumrows = data.total; if (sumrows == 0) { } if (load) { $.tl_page_slider({ hover_borderColor: "#383838", color: "#919191", borderColor: "#6B6B6B", pageid: pageid, pagesize: pagesize, sumrows: sumrows, fun: function (index) { pageid = index; url() }, request: true }); $("#my_page").hide() } if (data.rows.length > 0) { for (var i = 0; i < data.rows.length; i++) { var content = "<div v=" + data.rows[i].id + ' class="load">'; content += '<div class="block_i">'; content += '<a target="_blank" href="sharec' + data.rows[i].id + '.aspx">'; content += '<img src="p/s/' + data.rows[i].shareid + "/" + data.rows[i].sid + '_230.jpg" width="240" height="136"></a>'; content += '<div class="bg"></div>'; content += '<div class="block_op"><a class="title" target="_blank" href="sharec' + data.rows[i].id + '.aspx">' + data.rows[i].pname + '</a><a class="edit" href="share_list.aspx?sid=' + data.rows[i].shareid + '" title="相关"></a><a v="' + data.rows[i].shareid + '" class="share" title="喜欢"></a></div>'; content += "</div>"; content += "<p>"; content += '<span class="hits" title="' + data.rows[i].clicks + '次浏览">' + data.rows[i].clicks + "</span>"; content += '<span class="heats" title="' + data.rows[i].collects + '人喜欢">' + data.rows[i].collects + "</span>"; content += '<a class="url" target="_blank" href="sharec' + data.rows[i].id + '.aspx" class="link_url" target="_blank" title="打开">&nbsp;</a>'; if (role) { content += '<a target="_blank" href="resource_edit.aspx?id=' + data.rows[i].id + '">编辑</a>&nbsp;<a class="del">删除</a>' } content += "</p>"; content += "</div>"; content += ""; content += ""; content += ""; var bindIndex = 0; if (load) { bindIndex = (i + 1) % requestcolumns == 0 ? requestcolumns - 1 : (i + 1) % requestcolumns - 1 } else { var colTop = 100000; $("#list > div").each(function () { if ($(this).children("div:last").offset().top < colTop) { colTop = $(this).children("div:last").offset().top; bindIndex = $("#list > div").index($(this)) } }) } $("#list > div:eq(" + bindIndex + ")").append(content); $("#list > div > div.load").fadeIn(1000).delay(1000).removeClass("load"); $(".loading").hide() } } else { $(".loading").hide() } }, error: function () { alert("数据读取错误！") } }) } function url() { window.location.href = "share_list.aspx?pageid=" + pageid + "&pagesize=" + requestcolumns * requestcount + "&f_c=" + f_c + "&f_t=" + f_t + "&o=" + o + "&t=" + requestcolumns + "&sid=" + sid } $(function () { index = 3; $(".nav_" + index).bgPosition(nav_bg[index].x, nav_bg[index].y).stop().a({ left: 0 }, 150); $("#color-more").toggle(function () { $(this).css("background-position", "-5px -165px"); $("#filter-color ul").css("height", "auto") }, function () { $(this).css("background-position", "-5px -146px"); $("#filter-color ul").a({ height: 47 }, 200) }); $("#category-more").toggle(function () { $(this).css("background-position", "-5px -165px"); $("#filter-category ul").css({ "max-height": "200px", height: "100%" }) }, function () { $(this).css("background-position", "-5px -146px"); $("#filter-category ul").a({ height: 70 }, 200) }); $(".checkbox-category").toggle(function () { $(this).css("background-position", "0 -209px") }, function () { $(this).css("background-position", "0 -192px") }); $(".checkbox-filter").toggle(function () { $(this).css("background-position", "0 -209px") }, function () { $(this).css("background-position", "0 -192px") }); $(".checkbox-category-all").toggle(function () { $(".checkbox-category").css("background-position", "0 -209px") }, function () { $(".checkbox-category").css("background-position", "0 -192px") }); $(".checkbox-filter-all").toggle(function () { $(".checkbox-filter").css("background-position", "0 -209px") }, function () { $(".checkbox-filter").css("background-position", "0 -192px") }); $("#filter_1_ul").show(); $("#filter-filter #filter-filter-ul").children("li").click(function () { $("#" + $(this).attr("id") + "_ul").show().siblings().hide(); $(this).removeClass("filter-filter-default").addClass("filter-filter-check").siblings("li").removeClass("filter-filter-check").addClass("filter-filter-default") }); var b = { min: 200, containerID: "toTops" }; var a = b.containerID; $("#toTops").click(function () { $("html, body").animate({ scrollTop: 0 }, 200) }); $(window).scroll(function () { var c = $(window).scrollTop(); if (typeof document.body.style.maxHeight === "undefined") { $(a).css({ top: $(window).scrollTop() + $(window).height() - 50 }) } if (c > b.min) { $("#" + a).addClass("scaleTop") } else { $("#" + a).removeClass("scaleTop") } }); $("#toTops .item3 a").hover(function () { $(this).a({ left: -50 }, 150) }, function () { $(this).a({ left: 0 }, 150) }) });
